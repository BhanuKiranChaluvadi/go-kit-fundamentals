networks:
  gokit:

services:
  prometheus:
    image: prom/prometheus
    volumes:
      - ./prometheus-config.yml:/etc/prometheus/prometheus-config.yml
    command:
      - "--config.file=/etc/prometheus/prometheus-config.yml"
      - "--storage.tsdb.path=/prometheus"
    ports:
      - 9090:9090
    networks:
      - gokit

  loki:
    image: grafana/loki
    volumes:
      - ./loki-config.yml:/etc/loki/loki-config.yml
    command: 
      - "-config.file=/etc/loki/loki-config.yml"
    ports:  
      - "3100"
    networks:
      - gokit

  promtail:
    image: grafana/promtail:2.5.0
    volumes:
      - /var/log:/var/log
      - ./promtail-config.yml:/etc/promtail/config.yml
    command: -config.file=/etc/promtail/config.yml
    networks:
      - gokit

  tempo:
    image: grafana/tempo:latest
    command: [ "-config.file=/etc/tempo.yaml" ]
    volumes:
      - ../local/tempo-local.yaml:/etc/tempo.yaml
      - ./tempo-data:/tmp/tempo
    ports:
      - 14268:14268  # jaeger ingest
      - 3200:3200    # tempo
      - 4317:4317    # otlp grpc
      - 4318:4318    # otlp http
      - 9411:9411    # zipkin

  grafana:
    image: grafana/grafana-enterprise
    ports:
      - 3000:3000
    networks:
      - gokit

  priceservice01:
    build: 
      context: priceservice
    ports: 
      - 8081:8080
    networks:
      - gokit

  priceservice02:
    build: 
      context: priceservice
    ports: 
      - 8082:8080
    networks:
      - gokit

  priceservice03:
    build: 
      context: priceservice
    ports: 
      - 8083:8080
    networks:
      - gokit
